#Neostats Module Makefile!
CC=@CC@
CFLAGS=@CFLAGS@ -Ipcre
LDFLAGS= @LDFLAGS@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
DIRECTORY=@DIRINST@/dl/
INCLUDES=-I@DIRINST@/include/ -I.

SOURCES= SecureServ.c SecureServ_help.c http.c OnJoinBot.c FloodCheck.c Helpers.c
OBJECTS= SecureServ.o SecureServ_help.o http.o OnJoinBot.o FloodCheck.o Helpers.o
TARGET= SecureServ.so 
DOCS=README.SecureServ SecureServ.settings README.SecureServ.html html.css 
DATA=viri.dat
DISTFILES = $(SOURCES) $(DATA) $(DOCS) modconfig.h.in configure install-sh ChangeLog Makefile.in http.h SecureServ.h RelNotes.txt pcre/*.c pcre/*.h pcre/*.in pcre/README pcre/COPYING
distdir = @PACKAGE@-@VERSION@


all:	 module

.c.o:	
	 $(CC) -c $(CFLAGS) $(INCLUDES) $<

libpcre.a:
	 (cd pcre; $(MAKE) $@)

module:	 libpcre.a $(OBJECTS)
	 $(LD) -shared -o $(TARGET) $(OBJECTS) $(LDFLAGS) pcre/libpcre.a

clean:
	 (cd pcre; $(MAKE) $@)
	 /bin/rm -rf $(TARGET) *.o Makefile *.log modconfig.h

install: module
	 $(INSTALL) -m 644 $(TARGET) $(DIRECTORY)
	 $(INSTALL) -m 644 $(DOCS) $(DIRECTORY)../doc/
	 $(INSTALL) -m 644 $(DATA) $(DIRECTORY)../data/
	 @cd $(DIRECTORY)..; \
	 ./kptool -i doc/SecureServ.settings; 

dist:	
	@echo -n "Creating Directories"
	@-rm -rf $(distdir)
	@mkdir $(distdir)
	@mkdir $(distdir)/pcre
	@echo "Done"
	@echo -n "Coping Core Distribution Files"
	@for file in $(DISTFILES); do \
		echo -n "."; \
		cp -pr $$file $(distdir)/$$file; \
	done
	@echo "Done"
	@tar -czf $(distdir).tar.gz $(distdir)/*
	@rm -rf $(distdir)
	@echo "Tar file $(distdir).tar.gz created, Freshmeat Time"



$(OBJECTS): Makefile

SecureServ.o:		SecureServ.h SecureServ_help.c modconfig.h 
SecureServ_help.o: 	SecureServ.h modconfig.h
OnJoinBot.o:		SecureServ.h
FloodCheck.o:		SecureServ.h
Helpers.o:		SecureServ.h